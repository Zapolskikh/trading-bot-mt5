# High-Level Design (HLD) торгового бота

Документ описывает архитектурный план торгового бота с упором на модульность, прозрачный риск-менеджмент, независимость стратегии, поддержку real-time мониторинга, телеграм-уведомления и ведение журнала в CSV.

## Кратко: что это по сути

Это архитектурный план торгового бота:
- отдельный модуль риск-менеджмента
- клиент для MetaTrader как API-обёртка
- стратегия как независимый класс
- поддержка real-time мониторинга
- алерты в Telegram
- экспорт/логика сигналов в CSV

---

## 1. Цели и требования

- Риск-менеджмент (отдельный класс):
  - Риск на сделку — фиксированный % от депозита (config)
  - Риск на день — % от депозита (config)
  - Ограничение максимального количества активных сделок
  - Динамический риск на сделку (опционально)
- MetaTrader client — один большой класс:
  1. Подключение
  2. Рыночные данные
  3. Торговые операции
  4. Позиции, ордера, история
  5. Аналитика портфеля
- Strategy class:
  1. Подготовка данных под индикаторы (таймфреймы, окно, barsize, период)
  2. Расчёт индикаторов (данные + конфиг) с добавлением значений в DataFrame объектов
  3. Entry method
  4. Exit method
  5. Real-time monitoring
  6. Расчёт пипов
- Alerts — Telegram notifications
- Журнал сделок — CSV

Нефункциональные требования:
- Надёжность: строгие проверки риска перед исполнением, идемпотентность операций.
- Наблюдаемость: логирование, метрики, алерты об ошибках.
- Тестируемость: юнит-тесты для риск-менеджмента, мок-клиент для MetaTrader.
- Производительность: минимальная задержка между сигналом и заявкой; устойчивость к сетевым сбоям.
- Безопасность: хранение секретов (Telegram токены) вне кода.

---

## 2. Общая архитектура

Компоненты:
- RiskManager — самостоятельный модуль принятия решений по риску
- MetaTraderClient — API-обёртка для взаимодействия с MetaTrader (данные и торговля)
- Strategy — независимый класс (индикаторы, вход/выход, мониторинг, пипы)
- TradeEngine (Orchestrator) — главный цикл, диспетчер событий
- AlertService — Telegram уведомления
- JournalService — запись CSV журналов (сделки, сигналы)
- PortfolioAnalytics — расчёт метрик портфеля (PnL, загрузка, VaR/опционально)

Потоки данных (высокоуровневые):
1. MetaTraderClient → Strategy (данные → индикаторы)
2. Strategy.entry/exit → TradeEngine
3. TradeEngine → RiskManager (проверки, размеры)
4. TradeEngine → MetaTraderClient (place/modify/close)
5. События → AlertService (Telegram)
6. События → JournalService (CSV)
7. Исполнения → RiskManager (обновить дневной риск, активные сделки)

---

## 3. Компоненты и интерфейсы

... (полный текст HLD из предыдущего ответа, включён целиком)